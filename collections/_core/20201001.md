---
name: DIALS core meeting 2020-10-01
tags: core meeting
---

# DIALS core meeting 2020-10-01

[![hackmd-github-sync-badge](https://hackmd.io/DgbAANUsTDKAmlTK32ZNoQ/badge)](https://hackmd.io/DgbAANUsTDKAmlTK32ZNoQ)


## Previous Actions

* [ ] MG+ND: write a proposal for ['overall architecture discussion'](https://dials.github.io/kb/core/20200903) and ['new installer'](https://dials.github.io/kb/core/20200903)
    * first outcome to be discussed below
* [ ] ND: update `CONTRIBUTING` in a (separate) pull request to include a soft-imposition of [stable master](https://dials.github.io/kb/core/20200903),  [dials#1353](https://github.com/dials/dials/issues/1353).
* [ ] MG: organise a [typing intro lecture](https://dials.github.io/kb/core/20200917).

## Agenda

### renaming `master` branch â†’ `main`
* Nothing much will happen on this any time soon - either way we'll [wait for GitHub support on this one](https://github.com/github/renaming)
* General assent that this is useful
* from 1st of October new GitHub repositories will have `main` as the default
* **proposed outcome**: Turn this into a dxtbx+dials issue and remove from agenda until GitHub provides a migration path for existing repositories.

### Overall architecture discussion
Discuss proposal [DC1 -- per-module setup.py](https://hackmd.io/@dials/B11SXgTND)

**proposed outcome**: MG+ND to make this happen in a PR

### `cbflib_adaptbx` dependency
We are only referencing `compress` and `uncompress` functions, and `cbflib_adaptbx` has a MSVC-ancient-dependency. We could copy the functions into `dxtbx_ext` and remove the dependency.

**proposed outcome**: MG to make this happen in a PR

### cctbx conda-forge package
We may want to evaluate moving the dxtbx/DIALS Azure builds to use the cctbx conda-forge package, which [should become available shortly](https://github.com/conda-forge/cctbx-base-feedstock).

#### Benefits
* Faster builds
* Making use of clearer API boundaries and versioning

#### Drawbacks
* API boundaries and versioning
    * In other words: We would start treating cctbx as a software package. This restricts dxtbx/DIALS code to only use functionality that is part of the relevant cctbx release. From time to time, when cctbx releases new versions, we would update our dependencies, which would then allow the use of new cctbx features.

**proposed outcome**: MG+anyone interested in Azure to make this happen in a PR.

### Definition of `trusted_range`
Discuss [Definition of `trusted_range` (dxtbx#182)](https://github.com/cctbx/dxtbx/issues/182)

### `image_range` vs. `array_range` baked in off-by-one errors
Discuss [`image_range` vs. `array_range` baked in off-by-one errors (dxtbx#186)](https://github.com/cctbx/dxtbx/issues/186)

### DIALS documentation build
Should the DIALS documentation build outside a cctbx environment?

* Currently you can only build the DIALS documentation inside a cctbx environment. This means a remote documentation build needs to build cctbx first, so we can't easily run the documentation build on every commit. When things break they are difficult to fix. We can't use readthedocs.
* MG: I believe the main obstacles are three cctbx Sphinx plugins that may need to be extracted or removed from DIALS documentation, and some phil parsing logic.

### dxtbx json/msgpack performance
ASB reports json being problematic when importing e.g. 50,000 experiments, as everything is stored in a single file, so everything needs to be read at once.

* GW: cf. [Load before heat death (dxtbx#118)](https://github.com/cctbx/dxtbx/pull/118). At the core of it are bad design choices in dxtbx.
* Future discussion topics:
    1. treatment of large serial datasets
    2. using an HDF5 backend for reflection files
    3. [dials#1407](https://github.com/dials/dials/issues/1407) specific proposal
* ASB: I want `check_format` to go away.

Discussion outcomes:

* ASB:
    * General consensus that this is needed.
    * Make models and store them
    * Load them in parallel with minimal memory requirements
    * Version all models and rewind them
        * This needs a lot of thought and at this time we don't have agreement here.
    * Not need to copy data like shoeboxes when they aren't being changed, operate by reference

### Any other business

### Next meeting
October 15th, 4pm UK time, 8am PDT.